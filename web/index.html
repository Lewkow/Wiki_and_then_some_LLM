<!-- web/index.html -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>wiki_plus_llm — demo UI</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- optional: modern minimal styles -->
  <style>
    :root { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial, "Apple Color Emoji","Segoe UI Emoji"; }
    body { margin: 0; background: #0b1020; color: #e6ebff; }
    .wrap { max-width: 900px; margin: 40px auto; padding: 0 16px; }
    .card { background: #121833; border: 1px solid #1e2a55; border-radius: 16px; padding: 16px; box-shadow: 0 4px 30px #00000040; }
    .row { display: flex; gap: 8px; }
    input[type="text"] { flex: 1; padding: 12px 14px; border-radius: 12px; border: 1px solid #2b3a78; background: #0f1530; color: #e6ebff; }
    button { padding: 12px 16px; border-radius: 12px; border: 1px solid #2b3a78; background: #1d2a59; color: #e6ebff; cursor: pointer; }
    button:hover { filter: brightness(1.1); }
    .muted { opacity: 0.8; font-size: 14px; }
    pre { background: #0f1530; border: 1px solid #2b3a78; padding: 12px; border-radius: 12px; overflow: auto; }
    .answer { white-space: pre-wrap; background: #101735; border: 1px solid #24316b; padding: 12px; border-radius: 12px; }
    .sources { display: grid; gap: 10px; }
    .src { border: 1px solid #25326f; padding: 10px; border-radius: 10px; background: #0f1530; }
    a { color: #91b4ff; text-decoration: none; }
    a:hover { text-decoration: underline; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>wiki plus llm</h1>
    <p class="muted">Query your local RAG API.</p>

    <div class="card">
      <div class="row">
        <input id="q" type="text" placeholder="Ask something… e.g., What is Simple English Wikipedia?" />
        <button id="go">Ask</button>
      </div>
      <p class="muted" style="margin-top:8px">API: <code id="apiBase">http://localhost:8000</code></p>
    </div>

    <div id="status" style="margin:16px 0;"></div>

    <h2>Answer</h2>
    <div id="answer" class="answer">—</div>

    <h2 style="margin-top:16px;">Sources</h2>
    <div id="sources" class="sources"></div>

    <h2 style="margin-top:16px;">Raw Response</h2>
    <pre id="raw">{ }</pre>
  </div>

  <script>
    const apiBase = document.getElementById('apiBase').textContent.trim();
    const qEl = document.getElementById('q');
    const goEl = document.getElementById('go');
    const answerEl = document.getElementById('answer');
    const rawEl = document.getElementById('raw');
    const statusEl = document.getElementById('status');
    const sourcesEl = document.getElementById('sources');

    async function runQuery() {
      const query = qEl.value.trim();
      if (!query) return;

      answerEl.textContent = '…';
      sourcesEl.innerHTML = '';
      rawEl.textContent = '{ }';
      statusEl.textContent = 'Calling API...';

      try {
        const res = await fetch(`${apiBase}/query`, {
          method: 'POST',
          headers: {'content-type': 'application/json'},
          body: JSON.stringify({ query, top_k: 6 }),
        });
        const data = await res.json();

        // show answer
        answerEl.textContent = data.answer ?? '(no answer)';

        // show sources
        const srcs = Array.isArray(data.sources) ? data.sources : [];
        sourcesEl.innerHTML = '';
        srcs.forEach((s) => {
          const div = document.createElement('div');
          div.className = 'src';
          const title = s.doc_name || s.title || '(untitled)';
          const url = s.url || s.path || '';
          div.innerHTML = `
            <div><strong>${title}</strong></div>
            ${url ? `<div><a href="${url}" target="_blank" rel="noreferrer">${url}</a></div>` : ''}
            ${s.snippet ? `<div class="muted">${s.snippet}</div>` : ''}
          `;
          sourcesEl.appendChild(div);
        });

        // show raw JSON
        rawEl.textContent = JSON.stringify(data, null, 2);
        statusEl.textContent = res.ok ? 'OK' : `HTTP ${res.status}`;
      } catch (err) {
        statusEl.textContent = 'Error calling API (see console)';
        console.error(err);
      }
    }

    goEl.addEventListener('click', runQuery);
    qEl.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') runQuery();
    });
  </script>
</body>
</html>
